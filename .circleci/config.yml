version: 2.1

orbs:
  node: circleci/node@5.2.0

executors:
  node-executor:
    docker:
      - image: cimg/node:20.12

jobs:
  # This is the ONLY job we will run. Its sole purpose is to get the real error.
  debug_server_startup:
    executor: node-executor
    steps:
      - checkout
      
      - run:
          name: Install Backend Dependencies
          command: npm install --prefix backend
      
      # This step will now reveal the true error message.
      - run:
          name: Attempt to Start Server in Foreground
          command: |
            echo "Attempting to start the backend server in the foreground..."
            cd backend
            node server.mjs

workflows:
  debug-workflow:
    jobs:
      - debug_server_startup:
          context:
            - project-secrets